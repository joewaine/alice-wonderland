---
status: done
priority: p1
issue_id: "028"
tags: [security, xss, dom]
dependencies: []
---

# innerHTML XSS Vulnerability in HUD and QuestNotification

## Problem Statement

Multiple UI components use `innerHTML` to render strings derived from level data JSON files. If a static asset server were compromised or a MITM attack occurred, malicious HTML/JavaScript could be injected and executed in the user's browser.

## Findings

- `src/ui/HUD.ts:164-167` - `showChapterTitle` uses `innerHTML` with `title` and `subtitle` from level data
- `src/ui/QuestNotification.ts:117-128` - Renders `config.title` and `config.message` via `innerHTML` from quest data

Both strings originate from JSON files loaded via `fetch()`. No sanitization is performed.

## Proposed Solutions

### Option 1: Use textContent and DOM API

**Approach:** Replace `innerHTML` with `textContent` on individual DOM elements, or build elements programmatically (as already done correctly in `DialogueUI.ts:127-128`).

**Pros:**
- Eliminates XSS vector entirely
- Consistent with existing patterns in DialogueUI

**Cons:**
- Slightly more verbose DOM construction

**Effort:** 30 minutes

**Risk:** Low

## Recommended Action

Replace all `innerHTML` usage with `textContent` or programmatic DOM construction for any data-derived strings.

## Technical Details

**Affected files:**
- `src/ui/HUD.ts:164-167` - showChapterTitle method
- `src/ui/QuestNotification.ts:117-128` - notification rendering

## Acceptance Criteria

- [ ] No `innerHTML` usage with data-derived strings
- [ ] Chapter titles and quest notifications still display correctly
- [ ] Tests pass

## Work Log

### 2026-02-27 - Code Review Discovery

**By:** Claude Code (multi-agent review)

**Actions:**
- Identified innerHTML XSS vector in HUD and QuestNotification
- Confirmed DialogueUI already uses safe pattern as reference
